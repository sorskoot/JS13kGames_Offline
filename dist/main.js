!function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();t.Entity=function(){function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"entity",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scene=t,this.name=n+"_"+this.scene.meshes.length,this.position=r,this.rotation=o,this.vertices=[-.5,-.5,.5,.5,-.5,.5,-.5,.5,.5,.5,.5,.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5,-.5,-.5,.5,.5,-.5,.5,-.5,.5,.5,.5,.5,.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,.5,.5,.5,-.5,.5,-.5,.5,.5,-.5],this.faces=[8,10,11,11,9,8,12,13,15,15,14,12,1,3,7,7,5,1,17,16,18,18,19,17,2,0,4,4,6,2],this.uvs=[1,0,0,0,0,0,1,0,1,1,0,1,0,1,1,1,1,0,0,0,1,1,0,1,0,0,1,0,0,1,1,1,1,0,0,0,1,1,0,1,1,0,0,1,0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1],this.mesh=new BABYLON.Mesh(this.name,this.scene),this.mat=new BABYLON.StandardMaterial("mat",this.scene);var i=new BABYLON.Texture("tiles.png",this.scene,!1,!0,BABYLON.Texture.NEAREST_SAMPLINGMODE);this.mat.diffuseTexture=i,this.onPick=function(){},this.onPicked=function(){}}return n(e,[{key:"render",value:function(){}},{key:"onHitByLaser",value:function(e,t){return 0}},{key:"buildMesh",value:function(){var e=new BABYLON.VertexData;return this.normals=[],BABYLON.VertexData.ComputeNormals(this.vertices,this.faces,this.normals),e.positions=this.vertices,e.indices=this.faces,e.normals=this.normals,e.uvs=this.uvs,e.applyToMesh(this.mesh),this.mesh.material=this.mat,this.mesh.material.backFaceCulling=!1,this.mesh.position=new(Function.prototype.bind.apply(BABYLON.Vector3,[null].concat(function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}(this.position)))),this.mesh.actionManager=new BABYLON.ActionManager(this.scene),this.mesh.actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPickTrigger,function(e){this.onPick(this),this.scene.render(),this.onPicked(this)}.bind(this,this.mesh))),this.mesh.rotation.y=this.rotation*Math.PI/2,BABYLON.Tags.AddTagsTo(this.mesh,"entity"),this.mesh.entity=this,this.mesh}}]),e}()},function(e,t,r){"use strict";r(2);var n=r(3);new function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.canvas=document.getElementById("renderCanvas"),this.engine=new BABYLON.Engine(this.canvas,!0),this.scene=new BABYLON.Scene(this.engine),window.game=new n.Game(this.scene),game.createScene(this.scene),this.engine.runRenderLoop(function(){return t.scene.render()}),window.addEventListener("resize",function(){return t.engine.resize()})}},function(e,t,r){"use strict";window.rnd=function(e){return~~(Math.random()*e)},window.rotate=function(e,t){var r=Math.cos(t),n=Math.sin(t);return new BABYLON.Vector3(r*e.x-n*e.z,0,-n*e.x+r*e.z)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Game=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(4),i=r(5),s=r(6),a=r(7),u=r(8),c=r(9);t.Game=function(){function e(t){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scene=t,this.maps=this.initMaps(),this.puzzleManager=new o.PuzzleManager,this.initPuzzle(),this.laserbeam.onWin=function(){for(var e=r.scene.getMeshesByTags("entity"),t=0;t<e.length;t++)r.scene.removeMesh(e[t]);r.puzzleManager.next(),r.initPuzzle(),r.createPuzzle(),r.laserbeam.drawLaser()}}return n(e,[{key:"initPuzzle",value:function(){this.puzzle=this.puzzleManager.puzzle,this.laserbeam=new c.Laserbeam(this.scene,this.puzzle)}},{key:"initMaps",value:function(){for(var e=[],t=0;t<4;t++)for(var r=0;r<4;r++)e.push(new BABYLON.Vector4(t/4,r/4,t/4+.25,r/4+.25));return e}},{key:"createScene",value:function(e){new BABYLON.HemisphericLight("light1",new BABYLON.Vector3(1,1,0),e);new BABYLON.DirectionalLight("light1",new BABYLON.Vector3(-2,-3,1),e).position=new BABYLON.Vector3(6,9,3),this.vrHelper=e.createDefaultVRExperience(),this.createPuzzle();var t=new u.Ground(this.scene);e.gravity=new BABYLON.Vector3(0,-9.81,0),this.vrHelper.enableInteractions(),this.vrHelper.enableTeleportation({floorMeshName:t.name}),e.activeCamera.inertia=.6,e.activeCamera.speed=.5,e.activeCamera.applyGravity=!0,e.activeCamera.ellipsoid=new BABYLON.Vector3(1,1,1),e.collisionsEnabled=!0,e.activeCamera.checkCollisions=!0,this.laserbeam.drawLaser()}},{key:"createPuzzle",value:function(){for(var e=this,t=0;t<this.puzzle.length;t++)switch(this.puzzle[t].type){case"start":new a.Laser(this.scene,this.puzzle[t].pos,!0,this.puzzle[t].rot).onPicked=function(){var t=e.puzzle.find(function(e){return"start"===e.type});t.rot=(t.rot+1)%4,e.laserbeam.drawLaser()};break;case"end":new a.Laser(this.scene,this.puzzle[t].pos,!1,this.puzzle[t].rot).onPicked=function(){e.laserbeam.drawLaser()};break;case"mirror":new s.Mirror(this.scene,this.puzzle[t].pos,this.puzzle[t].rot).onPicked=function(){e.laserbeam.drawLaser()};break;case"wall":new i.Wall(this.scene,this.puzzle[t].pos,this.puzzle[t].rot)}}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();t.PuzzleManager=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.puzzles=[[{type:"start",pos:[4,.5,0],rot:1},{type:"end",pos:[-4,.5,0],rot:3}],[{type:"start",pos:[2,.5,3],rot:1},{type:"end",pos:[-2,.5,0],rot:3},{type:"mirror",pos:[-2,.5,3],rot:3}],[{type:"start",pos:[2,.5,3],rot:1},{type:"mirror",pos:[-2,.5,-2],rot:3},{type:"end",pos:[-2,.5,3],rot:3},{type:"wall",pos:[0,.5,3],rot:1},{type:"mirror",pos:[2,.5,-2],rot:3}],[{type:"start",pos:[-3,.5,5],rot:3},{type:"end",pos:[3,.5,5],rot:1},{type:"mirror",pos:[-3,.5,-1],rot:3},{type:"mirror",pos:[3,.5,-1],rot:1},{type:"wall",pos:[0,.5,5],rot:1},{type:"wall",pos:[0,.5,4],rot:1},{type:"wall",pos:[0,.5,3],rot:1},{type:"wall",pos:[-2,.5,3],rot:1},{type:"wall",pos:[-1,.5,3],rot:1},{type:"wall",pos:[-4,.5,3],rot:1},{type:"wall",pos:[0,1.5,5],rot:1},{type:"wall",pos:[0,1.5,4],rot:1},{type:"wall",pos:[0,1.5,3],rot:1},{type:"wall",pos:[-2,1.5,3],rot:1},{type:"wall",pos:[-1,1.5,3],rot:1},{type:"wall",pos:[-3,1.5,3],rot:1},{type:"wall",pos:[-4,1.5,3],rot:1}],[{type:"start",pos:[2,.5,3],rot:1},{type:"end",pos:[-4,.5,3],rot:3},{type:"wall",pos:[-1,.5,3],rot:2},{type:"mirror",pos:[2,.5,-2],rot:2},{type:"mirror",pos:[-4,.5,-6],rot:1},{type:"wall",pos:[-1,2.5,3],rot:2},{type:"wall",pos:[-1,1.5,3],rot:2},{type:"wall",pos:[-1,.5,-2],rot:2},{type:"wall",pos:[-1,.5,-3],rot:2},{type:"wall",pos:[-1,.5,-4],rot:2},{type:"wall",pos:[-1,.5,-5],rot:2},{type:"wall",pos:[-1,.5,-7],rot:2},{type:"wall",pos:[-1,2.5,-2],rot:2},{type:"wall",pos:[-1,1.5,-2],rot:2},{type:"mirror",pos:[4,.5,-2],rot:2},{type:"mirror",pos:[4,.5,-6],rot:2},{type:"wall",pos:[-1,2.5,-3],rot:2},{type:"wall",pos:[-1,1.5,-3],rot:2},{type:"wall",pos:[-1,2.5,-4],rot:2},{type:"wall",pos:[-1,1.5,-4],rot:2},{type:"wall",pos:[-1,2.5,-5],rot:2},{type:"wall",pos:[-1,1.5,-5],rot:2},{type:"wall",pos:[-1,2.5,-6],rot:2},{type:"wall",pos:[-1,1.5,-6],rot:2},{type:"wall",pos:[-1,2.5,-7],rot:2},{type:"wall",pos:[-1,1.5,-7],rot:2}]],this.currentPuzzle=(window.location.href.split("#")[1]||0)-1,this.next()}return n(e,[{key:"next",value:function(){this.currentPuzzle++,this.puzzle=this.puzzles[this.currentPuzzle]}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Wall=void 0;var n=r(0);t.Wall=function(e){function t(e,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r,"wall"));return n.uvs=[.25,.25,.25,.25,.25,.5,.25,.5,0,.25,0,.25,0,.5,0,.5,.25,.25,0,.25,.25,.5,0,.5,0,.25,.25,.25,0,.5,.25,.5,.25,.25,0,.25,.25,.5,0,.5],n.buildMesh(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n.Entity),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Mirror=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(0);t.Mirror=function(e){function t(e,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r,"mirror",n));return o.vertices=[-.5,-.5,.5,.5,-.5,-.5,-.5,.5,.5,.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,.5,.5,-.5,-.5,-.5,.5,.5,.5,.5,-.5,-.5,.5,.5,.5,.5,-.5,-.5,.5,-.5],o.faces=[6,8,9,9,7,6,4,1,3,3,5,4,11,10,12,2,0,4,4,5,2],o.uvs=[0,.75,.25,.5,.25,.75,.25,.75,0,.5,.25,.5,.5,.25,.25,.25,.5,.5,.25,.5,0,.75,.25,.75,.25,.5],o.buildMesh(),o.onPick=function(){o.rotation=(o.rotation+1)%4,o.mesh.rotation.y=Math.PI*o.rotation/2},o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.Entity),n(t,[{key:"onHitByLaser",value:function(e,t){return 0!==e&&1!==e?0:(this.mesh.getFacetNormal(e),t>0?1:t<0?2:void 0)}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Laser=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(0);t.Laser=function(e){function t(e,r,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=(o-1)%4;var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r,n?"startLaser":"endLaser",o));return i.isStart=!!n,i.vertices=[-.5,-.5,.5,.5,-.5,.5,-.5,.5,.5,.5,.5,.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,.5,.5,-.5,.5,-.5,.5,.5,-.5,.5,-.5,.5,.5,.5,.5,.5,-.5,-.5,.5,.5,-.5],i.faces=[0,2,3,3,1,0,4,5,7,7,6,4,16,17,19,19,18,16,13,12,14,14,15,13,9,8,10,10,11,9],i.uvs=[.5,.75,.25,.75,.5,1,.25,1,.25,.75,.5,.75,.25,1,.5,1,.5,.75,.5,1,.25,.75,.25,1,.5,1,.75,1,.5,.75,.75,.75,.25,.75,.25,1,0,.75,0,1],i.buildMesh(),i.onPick=function(){return i.mesh.rotation.y=i.mesh.rotation.y+Math.PI/2},i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.Entity),n(t,[{key:"onHitByLaser",value:function(e,t){return 5!==e&&4!==e||this.isStart?0:3}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Ground=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scene=t,this.mesh=new BABYLON.MeshBuilder.CreateTiledGround("Tiled Ground",{xmin:-10,zmin:-10,xmax:10,zmax:10,subdivisions:{h:20,w:20}},this.scene);var r=new BABYLON.Texture("tiles.png",this.scene,!1,!0,BABYLON.Texture.NEAREST_SAMPLINGMODE),n=new BABYLON.StandardMaterial("groundmat",this.scene);n.diffuseTexture=r,n.diffuseTexture.uScale=.249,n.diffuseTexture.vScale=.249,n.diffuseTexture.wrapU=BABYLON.Texture.MIRROR_ADDRESSMODE,n.diffuseTexture.wrapV=BABYLON.Texture.MIRROR_ADDRESSMODE,n.specularColor=new BABYLON.Color3(0,0,0),this.mesh.material=n,this.mesh.checkCollisions=!0}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();t.Laserbeam=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scene=t,this.puzzle=r,this.onWin=function(){}}return n(e,[{key:"drawLaser",value:function(){var e=this.puzzle.find(function(e){return"start"===e.type}),t=new(Function.prototype.bind.apply(BABYLON.Vector3,[null].concat(function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}(e.pos)))),r=e.rot,n=new BABYLON.Vector3(e.pos[0]+100*Math.sin(Math.PI*e.rot/2),.5,e.pos[2]+100*Math.cos(Math.PI*e.rot/2)),o=[t],i=t,s=0,a=0,u=void 0;do{s++;var c=this.calculateBeam(i,r,u);if(i=c.nextTarget,a=c.hitStatus,u=c.lastHit,i&&o.push(i),3==a)return void this.onWin();1==a&&(r=(r-1)%4),2==a&&(r=(r+1)%4)}while(0!=a&&s<25);if(1==o.length&&o.push(n),this.laser){var l=this.scene.getMeshByName("laserbeam");this.scene.removeMesh(l)}this.laser=BABYLON.MeshBuilder.CreateTube("laserbeam",{path:o,radius:.15},this.scene),BABYLON.Tags.AddTagsTo(this.laser,"entity"),this.laser.isPickable=!1}},{key:"calculateBeam",value:function(e,t,r){var n=new BABYLON.Vector3(Math.sin(Math.PI*t/2),0,Math.cos(Math.PI*t/2)),o=new BABYLON.Ray(e,n,100),i=this.scene.pickWithRay(o,function(e){return!(e.name.startsWith("startLaser")||!e.isPickable||e.name===r)});if(i.pickedMesh&&i.pickedMesh.entity){var s=i.pickedMesh.getFacetNormal(i.faceId),a=Math.round(180*Math.asin(BABYLON.Vector3.Cross(s,o.direction).y)/Math.PI),u=i.pickedMesh.entity.onHitByLaser(i.faceId,a);return{nextTarget:i.pickedMesh.position,hitStatus:u,lastHit:i.pickedMesh.name}}return{nextTarget:new BABYLON.Vector3(e.x+100*Math.sin(Math.PI*t/2),.5,e.z+100*Math.cos(Math.PI*t/2)),hitStatus:0,lastHit:void 0}}}]),e}()}]);